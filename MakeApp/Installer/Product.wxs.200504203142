<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

<Product Id="*" UpgradeCode="A5DCB4E8-13DF-4B55-8321-F5B370722125" Language="1033"
         Manufacturer="Bob -- K6RWY" Name="Make App"
         Version="!(bind.fileVersion.makeApp.cmp)"
         >

  <Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine"
           Manufacturer="Bob -- K6RWY" Description="Installs Make App"
           Comments="Copyright (c) Bob -- K6RWY"
           />

  <MajorUpgrade Schedule="afterInstallInitialize"
                AllowDowngrades="no"   IgnoreRemoveFailure="no"   AllowSameVersionUpgrades="no"
                DowngradeErrorMessage="A newer version of [ProductName] is already installed." />

  <MediaTemplate EmbedCab="yes" />

  <UI Id="My_InstallDir.ui">
    <UIRef Id="WixUI_InstallDir" />
    <Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog" Value="InstallDirDlg">
      NOT Installed
    </Publish>
    <Publish Dialog="InstallDirDlg" Control="Back" Event="NewDialog" Value="WelcomeDlg" Order="2">
      1
    </Publish>
  </UI>

  <WixVariable Id="WixUIDialogBmp" Value="C:\Program Files (x86)\WixApp\dialog.bmp"/>
  <WixVariable Id="WixUIBannerBmp" Value="C:\Program Files (x86)\WixApp\banner.bmp"/>

  <Icon     Id="MakeAppIcon.ico" SourceFile="$(var.SolutionDir)..\MakeApp.prj\res\MakeApp.ico"/>
  <Property Id="ARPPRODUCTICON"  Value="MakeAppIcon.ico" />

  <Feature Id="ProductFeatures" Title="Main Product" Level="1" >
    <ComponentGroupRef Id="MakeApp.ftr"/>
    <ComponentGroupRef Id="TestApp.ftr"/>
    <ComponentGroupRef Id="TestAppProj.ftr"/>
    <ComponentGroupRef Id="TestAppRes.ftr"/>
    <ComponentGroupRef Id="Help.ftr"/>
    <ComponentGroupRef Id="HelpTemplate.ftr"/>
    <ComponentGroupRef Id="UninstallmakeApp.ftr"/>
  </Feature>
</Product>

<Fragment>
<ComponentGroup Id="MakeApp.ftr">
  <ComponentRef Id="makeApp.cmp"/>
  <ComponentRef Id="Help.cmp"/>
</ComponentGroup>
<ComponentGroup Id="TestApp.ftr">
  <ComponentRef Id="Solution.cmp"/>
</ComponentGroup>
<ComponentGroup Id="TestAppProj.ftr">
  <ComponentRef Id="MainFrameCpp.cmp"/>
  <ComponentRef Id="MainFrameH.cmp"/>
  <ComponentRef Id="ResourceH.cmp"/>
  <ComponentRef Id="StdafxH.cmp"/>
  <ComponentRef Id="StdafxCpp.cmp"/>
  <ComponentRef Id="TargetH.cmp"/>
  <ComponentRef Id="TestAppCpp.cmp"/>
  <ComponentRef Id="TestAppH.cmp"/>
  <ComponentRef Id="TestAppRC.cmp"/>
  <ComponentRef Id="TestAppVCX.cmp"/>
  <ComponentRef Id="TestAppVCXFltrs.cmp"/>
  <ComponentRef Id="TestAppVCXUser.cmp"/>
  <ComponentRef Id="TestAppDocCpp.cmp"/>
  <ComponentRef Id="TestAppDocH.cmp"/>
  <ComponentRef Id="TestAppViewCPP.cmp"/>
  <ComponentRef Id="TestAppViewH.cmp"/>
  <ComponentRef Id="TestAppVpj.cmp"/>
</ComponentGroup>
<ComponentGroup Id="TestAppRes.ftr">
  <ComponentRef Id="TestAppICO.cmp"/>
  <ComponentRef Id="TestAppRC2.cmp"/>
  <ComponentRef Id="ToolBar00BMP.cmp"/>
  <ComponentRef Id="ToolBar01BMP.cmp"/>
</ComponentGroup>
<ComponentGroup Id="Help.ftr">
  <ComponentRef Id="HelpVcx.cmp"/>
  <ComponentRef Id="HelpVxcFltr.cmp"/>
  <ComponentRef Id="HelpVcxUser.cmp"/>
  <ComponentRef Id="HelpVpj.cmp"/>
  <ComponentRef Id="AppCss.cmp"/>
  <ComponentRef Id="HelpBat.cmp"/>
  <ComponentRef Id="IntroHtm.cmp"/>
  <ComponentRef Id="Makefile.cmp"/>
  <ComponentRef Id="OperationHtm.cmp"/>
  <ComponentRef Id="TestAppHhc.cmp"/>
  <ComponentRef Id="TestAppHhp.cmp"/>
</ComponentGroup>
<ComponentGroup Id="HelpTemplate.ftr">
  <ComponentRef Id="OneColumnDwt.cmp"/>
</ComponentGroup>
<ComponentGroup Id="UninstallmakeApp.ftr">
  <ComponentRef Id="UninstallmakeApp.cmp"/>
</ComponentGroup>
</Fragment>

<!--Directory structure-->
<Fragment>
  <Directory Id="TARGETDIR" Name="SourceDir">
    <Directory Id="ProgramFilesFolder">
      <Directory Id="MakeApp.pff" Name="MakeApp">
        <Directory Id="MakeApp_TestApp.pff" Name="TestApp" />
        <Directory Id="MakeApp_TestApp.proj.pff" Name="TestApp.proj">
          <Directory Id="MakeApp_TestApp.proj_res.pff" Name="res" />
        </Directory>
        <Directory Id="MakeApp_Help.pff" Name="Help">
          <Directory Id="MakeApp_Help_Templates.pff" Name="Templates" />
        </Directory>
        <Directory Id="MakeApp_TestApp.prj.pff" Name="TestApp.prj" />
      </Directory>
    </Directory>

    <Directory Id="ProgramMenuFolder" Name="StartMenu">
      <Directory Id="MakeApp.pmf" Name="MakeApp" />
    </Directory>

    <Directory Id="DesktopFolder" Name="Desktop" />
  </Directory>

  <Property Id="ApplicationFolderName" Value="MakeApp" />
  <Property Id="WIXUI_INSTALLDIR"      Value="MakeApp.pff"/>
  <Property Id="WixAppFolder"          Value="WixPerMachineFolder" />
</Fragment>

<Fragment>

  <Component Id="makeApp.cmp"  Guid="2E98AD00-57EF-4C1E-A8E6-973BB6CC9632" Directory="MakeApp.pff">
    <File Id="makeApp.cmp" Source="$(var.SolutionDir)..\Release\MakeApp.exe" KeyPath="yes"/>

    <Shortcut Id               = "makeApp.shc"
              Name             = "makeApp"
              Advertise        = "yes"
              Directory        = "MakeApp.pmf"
              WorkingDirectory = "MakeApp.pff"
              Icon             = "MakeAppIcon.ico"
              />

    <Shortcut Id               = "makeApp.dsk"
              Name             = "makeApp"
              Advertise        = "yes"
              Directory        = "DesktopFolder"
              WorkingDirectory = "MakeApp.pff"
              Icon             = "MakeAppIcon.ico"
              />
  </Component>

  <Component Id="Help.cmp"  Guid="1AA05739-2EDF-47CA-A922-26A9FAB6E740" Directory="MakeApp.pff">
    <File Id="Help.cmp" Source="$(var.SolutionDir)..\Release\MakeApp.chm" KeyPath="yes"/>
  </Component>

</Fragment>

<Fragment>

  <Component Id="Solution.cmp"  Guid="E461E5F9-D748-4AD8-9FFF-32ACCF8E07FE"
                                                                      Directory="MakeApp_TestApp.pff">
    <File Id="Solution.cmp" Source="$(var.SolutionDir)..\TestApp\TestApp.sln" KeyPath="yes"/>
  </Component>

</Fragment>

<Fragment>

  <Component Id="MainFrameCpp.cmp"  Guid="A6ED0CDF-FAB6-4D10-9D97-460A2986C6B1"
                                                                  Directory="MakeApp_TestApp.prj.pff">
    <File Id="MainFrameCpp.cmp" Source="$(var.SolutionDir)..\TestApp.prj\MainFrame.cpp" KeyPath="yes"/>
  </Component>

  <Component Id="MainFrameH.cmp"  Guid="4C3F6D87-E030-4694-9020-74EA003DC2F8"
                                                                  Directory="MakeApp_TestApp.prj.pff">
    <File Id="MainFrameH.cmp" Source="$(var.SolutionDir)..\TestApp.prj\MainFrame.h" KeyPath="yes"/>
  </Component>

  <Component Id="ResourceH.cmp"  Guid="C7B7F8E1-92F5-4231-963E-DEFE94702AC4"
                                                                  Directory="MakeApp_TestApp.prj.pff">
    <File Id="ResourceH.cmp" Source="$(var.SolutionDir)..\TestApp.prj\Resource.h" KeyPath="yes"/>
  </Component>

  <Component Id="StdafxH.cmp"  Guid="51088E69-7EB7-4767-94F5-AAC912FF5AE4"
                                                                  Directory="MakeApp_TestApp.prj.pff">
    <File Id="StdafxH.cmp" Source="$(var.SolutionDir)..\TestApp.prj\stdafx.h" KeyPath="yes"/>
  </Component>

  <Component Id="StdafxCpp.cmp"  Guid="AAA5D6D1-D9B9-4428-BB40-36FAD19F5392"
                                                                  Directory="MakeApp_TestApp.prj.pff">
    <File Id="StdafxCpp.cmp" Source="$(var.SolutionDir)..\TestApp.prj\stdafx.cpp" KeyPath="yes"/>
  </Component>

  <Component Id="TargetH.cmp"  Guid="F889C1DE-B38C-4FEA-9F33-BB9B3675C055"
                                                                  Directory="MakeApp_TestApp.prj.pff">
    <File Id="TargetH.cmp" Source="$(var.SolutionDir)..\TestApp.prj\targetver.h" KeyPath="yes"/>
  </Component>

  <Component Id="TestAppCpp.cmp"  Guid="36BC0958-2DC5-47DE-A490-6231436E4832"
                                                                  Directory="MakeApp_TestApp.prj.pff">
    <File Id="TestAppCpp.cmp" Source="$(var.SolutionDir)..\TestApp.prj\TestApp.cpp" KeyPath="yes"/>
  </Component>

  <Component Id="TestAppH.cmp"  Guid="A38B44FE-13BD-4B48-9C54-8BABB514B391"
                                                                  Directory="MakeApp_TestApp.prj.pff">
    <File Id="TestAppH.cmp" Source="$(var.SolutionDir)..\TestApp.prj\TestApp.h" KeyPath="yes"/>
  </Component>

  <Component Id="TestAppRC.cmp"  Guid="DF40550A-661C-4202-8E25-1AAB9948AFDA"
                                                                  Directory="MakeApp_TestApp.prj.pff">
    <File Id="TestAppRC.cmp" Source="$(var.SolutionDir)..\TestApp.prj\TestApp.rc" KeyPath="yes"/>
  </Component>

  <Component Id="TestAppVCX.cmp"  Guid="D4F308B7-04A7-4187-AC12-CBD6F14AD593"
                                                                  Directory="MakeApp_TestApp.prj.pff">
    <File Id="TestAppVCX.cmp" Source="$(var.SolutionDir)..\TestApp.prj\TestApp.vcxproj" KeyPath="yes"/>
  </Component>

  <Component Id="TestAppVCXFltrs.cmp"  Guid="1AF4BD67-653F-4212-8F52-AD320C5D5ABA"
                                                                  Directory="MakeApp_TestApp.prj.pff">
    <File Id="TestAppVCXFltrs.cmp"
                    Source="$(var.SolutionDir)..\TestApp.prj\TestApp.vcxproj.filters" KeyPath="yes"/>
  </Component>

  <Component Id="TestAppVCXUser.cmp"  Guid="6A7DD8E7-2EBC-492B-98E0-E493540D3F4D"
                                                                  Directory="MakeApp_TestApp.prj.pff">
    <File Id="TestAppVCXUser.cmp"
                        Source="$(var.SolutionDir)..\TestApp.prj\TestApp.vcxproj.user" KeyPath="yes"/>
  </Component>

  <Component Id="TestAppDocCpp.cmp"  Guid="CC1F70E4-B878-4666-9386-AD6B495B9ED1"
                                                                  Directory="MakeApp_TestApp.prj.pff">
    <File Id="TestAppDocCpp.cmp"
                              Source="$(var.SolutionDir)..\TestApp.prj\TestAppDoc.cpp" KeyPath="yes"/>
  </Component>

  <Component Id="TestAppDocH.cmp"  Guid="69CAB8A3-3F74-4B1D-9FEA-932DE63ED15E"
                                                                  Directory="MakeApp_TestApp.prj.pff">
    <File Id="TestAppDocH.cmp" Source="$(var.SolutionDir)..\TestApp.prj\TestAppDoc.h" KeyPath="yes"/>
  </Component>

  <Component Id="TestAppViewCPP.cmp"  Guid="BD654BF6-388E-4691-9679-93D8C5FCC875"
                                                                  Directory="MakeApp_TestApp.prj.pff">
    <File Id="TestAppViewCPP.cmp"
                            Source="$(var.SolutionDir)..\TestApp.prj\TestAppView.cpp" KeyPath="yes"/>
  </Component>

  <Component Id="TestAppViewH.cmp"  Guid="EAF97553-E967-4EA2-ABD5-596FE8776B80"
                                                                  Directory="MakeApp_TestApp.prj.pff">
    <File Id="TestAppViewH.cmp" Source="$(var.SolutionDir)..\TestApp.prj\TestAppView.h" KeyPath="yes"/>
  </Component>

  <Component Id="TestAppVpj.cmp"  Guid="E83AAB93-CBC0-439C-9B97-490DAD817DF3"
                                                                  Directory="MakeApp_TestApp.prj.pff">
    <File Id="TestAppVpj.cmp" Source="$(var.SolutionDir)..\TestApp.prj\TestApp.vpj" KeyPath="yes"/>
  </Component>

</Fragment>

<Fragment>

  <Component Id="TestAppICO.cmp"  Guid="FA75ABE0-D238-46C0-B13D-DFBB13CFF29E"
                                                            Directory="MakeApp_TestApp.proj_res.pff">
    <File Id="TestAppICO.cmp" Source="$(var.SolutionDir)..\TestApp.prj\res\TestApp.ico" KeyPath="yes"/>
  </Component>

  <Component Id="TestAppRC2.cmp"  Guid="40B8591D-C47F-4D3D-A76B-7CB8A6073639"
                                                            Directory="MakeApp_TestApp.proj_res.pff">
    <File Id="TestAppRC2.cmp" Source="$(var.SolutionDir)..\TestApp.prj\res\TestApp.rc2" KeyPath="yes"/>
  </Component>

  <Component Id="ToolBar00BMP.cmp"  Guid="7574B53E-FA4B-4FAE-A0E7-6AE1E3D4A2BC"
                                                            Directory="MakeApp_TestApp.proj_res.pff">
    <File Id="ToolBar00BMP.cmp"
                          Source="$(var.SolutionDir)..\TestApp.prj\res\Toolbar00.bmp" KeyPath="yes"/>
  </Component>

  <Component Id="ToolBar01BMP.cmp"  Guid="D9F46600-4A79-489E-BEDE-2CCCA4A0067E"
                                                            Directory="MakeApp_TestApp.proj_res.pff">
    <File Id="ToolBar01BMP.cmp"
                          Source="$(var.SolutionDir)..\TestApp.prj\res\Toolbar01.bmp" KeyPath="yes"/>
  </Component>

</Fragment>

<Fragment>

  <Component Id="HelpVcx.cmp"  Guid="CF890A5B-5D91-4642-ABA7-5028A832E699"
                                                                        Directory="MakeApp_Help.pff">
    <File Id="HelpVcx.cmp" Source="$(var.SolutionDir)..\Help\Help.vcxproj" KeyPath="yes"/>
  </Component>

  <Component Id="HelpVxcFltr.cmp"  Guid="C9B04410-9CBF-42E0-BE9C-E69DA38A6EC4"
                                                                        Directory="MakeApp_Help.pff">
    <File Id="HelpVxcFltr.cmp" Source="$(var.SolutionDir)..\Help\Help.vcxproj.filters" KeyPath="yes"/>
  </Component>

  <Component Id="HelpVcxUser.cmp"  Guid="FCE9B55E-7355-4836-8741-9B4FA864EE66"
                                                                        Directory="MakeApp_Help.pff">
    <File Id="HelpVcxUser.cmp" Source="$(var.SolutionDir)..\Help\Help.vcxproj.user" KeyPath="yes"/>
  </Component>

  <Component Id="HelpVpj.cmp"  Guid="2EC8714F-6034-4C65-9BB5-6E8BF2C9B9DB"
                                                                        Directory="MakeApp_Help.pff">
    <File Id="HelpVpj.cmp" Source="$(var.SolutionDir)..\Help\Help.vpj" KeyPath="yes"/>
  </Component>

  <Component Id="AppCss.cmp"  Guid="FCBDC93C-3D8F-460A-82A0-337404603101" Directory="MakeApp_Help.pff">
    <File Id="AppCss.cmp" Source="$(var.SolutionDir)..\Help\App.css" KeyPath="yes"/>
  </Component>

  <Component Id="HelpBat.cmp"  Guid="127DE928-3094-4EDD-B8AF-1ACFAEFAA813"
                                                                        Directory="MakeApp_Help.pff">
    <File Id="HelpBat.cmp" Source="$(var.SolutionDir)..\Help\helpComp.bat" KeyPath="yes"/>
  </Component>

  <Component Id="IntroHtm.cmp"  Guid="6EF73CFE-16C5-4204-B112-35786150645F"
                                                                        Directory="MakeApp_Help.pff">
    <File Id="IntroHtm.cmp" Source="$(var.SolutionDir)..\Help\Introduction.htm" KeyPath="yes"/>
  </Component>

  <Component Id="Makefile.cmp"  Guid="6BF1DDB5-300D-422E-B113-5708709D33DC"
                                                                        Directory="MakeApp_Help.pff">
    <File Id="Makefile.cmp" Source="$(var.SolutionDir)..\Help\makefile" KeyPath="yes"/>
  </Component>

  <Component Id="OperationHtm.cmp"  Guid="34054CCA-1A59-4840-A377-6320DD2E4ABE"
                                                                        Directory="MakeApp_Help.pff">
    <File Id="OperationHtm.cmp" Source="$(var.SolutionDir)..\Help\Operations.htm" KeyPath="yes"/>
  </Component>

  <Component Id="TestAppHhc.cmp"  Guid="719EDEE9-55CE-4A91-9862-BFF22E45BA73"
                                                                        Directory="MakeApp_Help.pff">
    <File Id="TestAppHhc.cmp" Source="$(var.SolutionDir)..\Help\TestApp.hhc" KeyPath="yes"/>
  </Component>

  <Component Id="TestAppHhp.cmp"  Guid="AD3F3C5E-3C2B-4CAF-B7B9-234F1FA34076"
                                                                        Directory="MakeApp_Help.pff">
    <File Id="TestAppHhp.cmp" Source="$(var.SolutionDir)..\Help\TestApp.hhp" KeyPath="yes"/>
  </Component>

</Fragment>

<Fragment>

  <Component Id="OneColumnDwt.cmp"  Guid="FFA3892C-7BAA-4B93-AA2D-E21FA7DA9ACE"
                                                              Directory="MakeApp_Help_Templates.pff">
    <File Id="OneColumnDwt.cmp"
                        Source="$(var.SolutionDir)..\Help\Templates\OneColumnPage.dwt" KeyPath="yes"/>
  </Component>

</Fragment>

<Fragment>

  <Component Id="UninstallmakeApp.cmp" 
                                  Guid="B69F4237-8514-4115-B112-9DC62661C7FA" Directory="MakeApp.pmf">

    <Shortcut Id               = "UninstallmakeApp.shc"
              Name             = "Uninstall makeApp"
              Description      = "Uninstalls makeApp"
              Target           = "[System64Folder]msiexec.exe"
              Arguments        = "/x [ProductCode]"
              Icon             = "MakeAppIcon.ico"
              />
    <RemoveFolder Id="MakeApp.uni" Directory="MakeApp.pmf" On="uninstall"/>
    <RegistryValue Root="HKCU" Key="Software\UninstallmakeApp.cmp" Name="installed"
                   Type="integer" Value="1" KeyPath="yes"/>
  </Component>

</Fragment>

</Wix>
